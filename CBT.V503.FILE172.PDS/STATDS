//#SYSP17S JOB ,'DAVID CARTWRIGHT',CLASS=2,REGION=0M,
//         MSGCLASS=X,NOTIFY=&SYSUID
//*      PDSDOC *PROGRAM TO GIVE STATISTICS ON A DATASET..............*
//*
//STEP01  EXEC ASMHCL,
//             PARM.C='NODECK,OBJECT',
//*             COND.L=(99,NE),
//             PARM.L='LIST,MAP,LET'
//C.SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//           DD  DISP=SHR,DSN=SYS1.MODGEN
//           DD  DISP=SHR,DSN=$SYSP17.DHC.SOURCE
//C.SYSIN    DD  *
*          DATA SET CBT811     AT LEVEL 004 AS OF 05/12/82
 TITLE 'DISK DATA SET STATISTICS PROGRAM    --     BY  A. BRUCE LELAND' 00001
*                                                                       00002
*   COMPUTE DATA SET USEAGE STATISTICS FOR DISK DATA SETS               00003
*                                                                       00004
*   PROGRAMMER:  A. BRUCE LELAND                                        00005
*                                                                       00006
*   DESCRIPTION:  THIS PROGRAM FORMATS INFORMATION ON ANY DISK DATA     00007
*        SET.  IT READS THROUGH THE ENTIRE DATA SET AND OUTPUTS DISK    00008
*        TRACK USAGE, BLOCKSIZE AND OTHER STATISTICS.                   00009
*                                                                       00010
*                                                                       00011
*   OPERATION:                                                          00012
*       A.  THE PROGRAM GETS THE INPUT DATA SET NAME AND VOLUME SERIAL  00013
*           NUMBER VIA "RDJFCB".                                        00014
*                                                                       00015
*       B.  THE PROGRAM INPUTS THE FORMAT 1 DSCB TO DETERMINE OTHER     00016
*           DATA SET CHARACTERISTICS.                                   00017
*                                                                       00018
*       C.  THE PROGRAM OPENS THE INPUT FILE, THEN FORMATS AND          00019
*           OUTPUTS DEB AND DSCB INFORMATION.                           00020
*                                                                       00021
*       D.  IF A PARM OF "LABEL" IS NOT CODED, THE PROGRAM READS        00022
*           EACH BLOCK OF DATA IN THE DATA SET AND COLLECTS RECORD      00023
*           COUNTS, RECORD SIZE AND TRACK USEAGE STATISTICS.            00024
*                                                                       00025
*       E.  ADDITIONAL PROCESSING:                                      00026
*                                                                       00027
*           1. FOR DSORG=PS, NONE.                                      00028
*                                                                       00029
*           2. FOR DSORG=DA, NONE.                                      00030
*                                                                       00031
*           3. FOR DSORG=IS, THE PROGRAM READS THROUGH THE ENTIRE       00032
*              DATA SET (THERE MAY BE UP TO THREE SEPARATE FILES OF     00033
*              DATA AND REPORTS ON EACH FILE.  ALSO, THE PROGRAM        00034
*              INPUTS THE ISAM LABEL (FORMAT TWO DSCB) RECORD AND       00035
*              PROVIDES A DATA SET PROFILE WHICH INCLUDES DATA SET      00036
*              REORGAINIZATION DATA AND DATA SET CHARACTERISTICS.       00037
*                                                                       00038
*           4. FOR DSORG=PO, THE PROGRAM COMPARES DIRECTORY TTR'S       00039
*              AGAINST ACTUAL DISK ADDRESSES TO DETERMINE THE TTRS      00040
*              OF "GAS" MEMBERS (THE PROGRAM ALSO OUTPUTS THE FIRST     00041
*              79 CHARACTERS OF ANY GAS MEMBER).  STATISTICS ARE        00042
*              MAINTAINED ON THE SIZE OF GAS AND REAL MEMBERS AND       00043
*              THE NUMBER OF ALIAS MEMBERS.                             00044
*              IF ANY ALIASES ARE IN THE DATA SET, A CHECK IS MADE      00045
*              TO SEE THAT CORRESPONDING REAL ENTRIES ALSO EXIST.       00046
*              NOTE: A PARM OF 'NO' WILL NULLIFY THE GAS TTR REPORT.    00047
*                                                                       00048
*                                                                       00049
         PRINT NOGEN                                                    00050
         EJECT                                                          00051
         MACRO                                                          00052
&LBL     OUTPT   &R0,&R1,&LN=50     OUTPUT MACRO                        00053
&LBL     LA      R15,&LN       LENGTH OF STRING                         00054
         AIF     ('&R0' EQ 'R0').NOR0                                   00055
         L       R0,&R0        NUMBER TO BE OUTPUT                      00056
.NOR0    LA      R1,&R1        STRING TO FOLLOW                         00057
         BAL     R14,OUTRTN    OUTPUT ROUTINE                           00058
         AIF     ('&R1' NE 'WORK').MEND                                 00059
         MVC     WORK(80),BLANKS                                        00060
.MEND    MEND                                                           00061
*                                                                       00062
         MACRO                                                          00063
&LBL     TTRMBB  &TTR,&MBB=DOUBLE  TTR TO MBBCCHHR CONVERSION MACRO     00064
&LBL     STM     R14,R12,12(R13)                                        00065
         L       R1,&TTR           TTRN ACTUALLY                        00066
         SLDL    R0,24             SHIFT TTR INTO R0                    00067
         SLL     R0,8              ADJUST                               00068
         L       R1,DCBDEBAD       DEB ADDRESS                          00069
         LA      R2,&MBB           RESULT ADDRESS                       00070
         LR      R3,R13            SAVE SAVEAREA REGISTER               00071
         L       R15,16            CVT POINTER                          00072
         L       R15,28(,R15)      TTRN->MBBCCHHR ROUTINE ADDRESS       00073
         BALR    R14,R15                                                00074
         LR      R13,R3                                                 00075
         LM      R14,R12,12(R13)                                        00076
         MEND                                                           00077
*                                                                       00078
         MACRO                                                          00079
&LBL     MBBTTR  &MBB,&TTR=TEMP    MBBCCHHR TO TTR CONVERSION MACRO     00080
&LBL     L       R0,TRACKNUM       CURRENT TRACK NUMBER (RELATIVE 1)    00081
         BCTR    R0,0              CURRENT TRACK NUMBER (RELATIVE 0)    00082
         L       R1,LASTR          CURRENT RECORD NUMBER                00083
         LA      R1,1(,R1)         NEXT RECORD NUMBER (R OF TTR)        00084
         CLC     CURMBB(7),&MBB    SWITCHED TRACKS?                     00085
         BE      *+10              NO, BRANCH                           00086
         LA      R1,1              RECORD ONE                           00087
         AR      R0,R1             NEXT RELATIVE TRACK                  00088
         STH     R0,&TTR           SAVE RELATIVE TRACK NUMBER           00089
         STC     R1,&TTR+2         SAVE RECORD NUMBER                   00090
         MEND                                                           00091
*                                                                       00092
         MACRO                                                          00093
&LBL     HEXES   &SRC,&NUM,&OUT     OUTPUT LOOKS LIKE C1.C2.C3 . . .    00094
         LCLC    &ONE                    FOR NUM SOURCE CHARACTERS      00095
&ONE     SETC    'HX'.'&SYSNDX'                                         00096
&LBL     SR      R15,R15                                                00097
         LA      R14,&NUM                                               00098
         LR      R1,R14                                                 00099
         BCTR    R1,0                                                   00100
         LA      R1,&NUM.(R1,R1)    LAST PERIOD AT (N-1)*3+1            00101
         LA      R1,&OUT.(R1)                                           00102
         S       R1,=F'3'           OUTPUT START LOCATION               00103
&ONE     LA      R15,&SRC           SOURCE BASE ADDRESS                 00104
         SR      R0,R0                                                  00105
         BCTR    R15,0                                                  00106
         IC      R0,0(R14,R15)      INPUT CHARACTER                     00107
         LR      R15,R0                                                 00108
         N       R15,=F'15'                                             00109
         IC      R15,HEXTBL(R15)                                        00110
         STC     R15,2(,R1)         LOW NIBBLE                          00111
         LR      R15,R0                                                 00112
         SRL     R15,4                                                  00113
         IC      R15,HEXTBL(R15)                                        00114
         STC     R15,1(,R1)         HIGH NIBBLE                         00115
         MVI     0(R1),C'.'         SEPARATOR                           00116
         S       R1,=F'3'           BACK UP 3 IN OUTPUT ADDRESS         00117
         BCT     R14,&ONE           DO PREVIOUS INPUT CHARACTER         00118
         MVI     3(R1),X'40'        BLANK THE LEADING PERIOD            00119
         MEND                                                           00120
*                                                                       00121
         MACRO                                                          00122
&LBL     DCBCONV &OUT=WORK      FORMATS A STRING LIKE "DCB=(RECFM=...)" 00123
         LCLC    &ONE                                                   00124
&ONE     SETC    'DB'.'&SYSNDX'   UNIQUE LABEL PORTION                  00125
&LBL     LA      R1,&OUT                                                00126
         MVC     0(12,R1),=CL12'DCB=(RECFM=*'                           00127
         LA      R1,11(,R1)                                             00128
         TM      DS1RECFM,X'C0'   RECFM=U?                              00129
         BNO     *+12             NO, BRANCH                            00130
         MVI     0(R1),C'U'                                             00131
         B       &ONE.A                                                 00132
         TM      DS1RECFM,X'80'   RECFM=F?                              00133
         BNO     *+12             NO, BRANCH                            00134
         MVI     0(R1),C'F'                                             00135
         B       &ONE.A                                                 00136
         TM      DS1RECFM,X'40'   RECFM=V?                              00137
         BNO     *+8              NO, BRANCH                            00138
         MVI     0(R1),C'V'                                             00139
&ONE.A   LA      R1,1(,R1)                                              00140
         TM      DS1RECFM,X'10'   RECFM=.B?                             00141
         BNO     *+12             NO, BRANCH                            00142
         MVI     0(R1),C'B'                                             00143
         LA      R1,1(,R1)                                              00144
         TM      DS1RECFM,X'20'   RECFM=.T?                             00145
         BNO     *+12             NO, BRANCH                            00146
         MVI     0(R1),C'T'                                             00147
         LA      R1,1(,R1)                                              00148
         TM      DS1RECFM,X'04'   RECFM=.A?                             00149
         BNO     *+12             NO, BRANCH                            00150
         MVI     0(R1),C'A'                                             00151
         LA      R1,1(,R1)                                              00152
         TM      DS1RECFM,X'02'   RECFM=.M?                             00153
         BNO     *+12             NO, BRANCH                            00154
         MVI     0(R1),C'M'                                             00155
         LA      R1,1(,R1)                                              00156
         TM      DS1RECFM,X'C0'   RECFM=U?                              00157
         BO      &ONE.C           YES, NO LRECL MESSAGE                 00158
         MVC     0(7,R1),=CL7',LRECL='                                  00159
         LA      R1,7(,R1)                                              00160
         LH      R15,DS1LRECL                                           00161
         CVD     R15,DOUBLE                                             00162
         UNPK    DOUBLE(5),DOUBLE+5(3)                                  00163
         LA      R15,DOUBLE-1                                           00164
         LA      R15,1(,R15)      SCAN                                  00165
         CLI     0(R15),C'0'          PAST LAST                         00166
         BE      *-8                           LEADING ZERO             00167
         OI      DOUBLE+4,X'F0'                                         00168
&ONE.B   MVC     0(1,R1),0(R15)   MOVE IN EACH CHARACTER                00169
         LA      R1,1(,R1)                                              00170
         LA      R15,1(,R15)                                            00171
         TM      0(R15),X'F0'     NEXT CHARACTER NUMERIC?               00172
         BO      &ONE.B           NO, BRANCH                            00173
&ONE.C   MVC     0(9,R1),=CL9',BLKSIZE='                                00174
         LA      R1,9(,R1)                                              00175
         LH      R15,DS1BLKSI                                           00176
         CVD     R15,DOUBLE                                             00177
         UNPK    DOUBLE(5),DOUBLE+5(3)                                  00178
         LA      R15,DOUBLE-1                                           00179
         LA      R15,1(,R15)      SCAN                                  00180
         CLI     0(R15),C'0'          PAST LAST                         00181
         BE      *-8                           LEADING ZERO             00182
         OI      DOUBLE+4,X'F0'                                         00183
&ONE.D   MVC     0(1,R1),0(R15)   MOVE IN EACH CHARACTER                00184
         LA      R1,1(,R1)                                              00185
         LA      R15,1(,R15)                                            00186
         TM      0(R15),X'F0'     NEXT CHARACTER NUMERIC?               00187
         BO      &ONE.D           NO, BRANCH                            00188
         MVC     0(7,R1),=CL7',DSORG='                                  00189
         LA      R1,7(,R1)                                              00190
         TM      DS1DSORG,X'40'   PS?                                   00191
         BNO     *+10             NO, BRANCH                            00192
         MVC     0(2,R1),=CL2'PS'                                       00193
         TM      DS1DSORG,X'02'   PO?                                   00194
         BNO     *+10             NO, BRANCH                            00195
         MVC     0(2,R1),=CL2'PO'                                       00196
         TM      DS1DSORG,X'20'   DA?                                   00197
         BNO     *+10             NO, BRANCH                            00198
         MVC     0(2,R1),=CL2'DA'                                       00199
         TM      DS1DSORG,X'80'   IS?                                   00200
         BNO     *+10             NO, BRANCH                            00201
         MVC     0(2,R1),=CL2'IS'                                       00202
         TM      DS1DSORG,X'01'   UNMOVEABLE?                           00203
         BNO     *+12             NO, BRANCH                            00204
         MVI     2(R1),C'U'                                             00205
         LA      R1,1(,R1)                                              00206
         MVI     2(R1),C')'                                             00207
         MEND                                                           00208
*                                                                       00209
STATS    CSECT                                                          00210
R0       EQU   0                                                        00211
R1       EQU   1                                                        00212
R2       EQU   2                                                        00213
R3       EQU   3                                                        00214
R4       EQU   4                                                        00215
R5       EQU   5                                                        00216
R6       EQU   6                                                        00217
R7       EQU   7                                                        00218
R8       EQU   8                                                        00219
R9       EQU   9                                                        00220
R10      EQU   10                                                       00221
R11      EQU   11                                                       00222
R12      EQU   12                                                       00223
R13      EQU   13                                                       00224
R14      EQU   14                                                       00225
R15      EQU   15                                                       00226
         SAVE  (14,12),,*                                               00227
         LR    R10,R15                                                  00228
         LA    R15,4095                                                 00229
         LA    R11,1(R15,R10)                                           00230
         LA    R12,1(R15,R11)                                           00231
         USING STATS,R10,R11,R12                                        00232
         ST    R13,SAVE+4                                               00233
         LR    R2,R13                                                   00234
         LA    R13,SAVE                                                 00235
         ST    R13,8(R2)                                                00236
         LA    R9,IN                                                    00237
         USING IHADCB,R9                                                00238
         L     R1,0(R1)             PARM ADDRESS                        00239
         LH    R0,0(R1)                                                 00240
         LTR   R0,R0                IS LENGTH ZERO?                     00241
         BZ    OPENIT               YES, BRANCH                         00242
*        CLI   2(R1),C'N'           NO, ARE GAS RECORDS DESIRED?        00243
*        BNE   *+8                      YES, BRANCH                     00244
         NI    FLAGS,255-GAS            NO, TURN OFF GAS RECORDS        00245
         CLI   2(R1),C'L'           LABEL INFORMATION ONLY?             00246
         BNE   OPENIT               NO, BRANCH                          00247
         OI    FLAGS,LABELS         YES, SET THE "LABELS ONLY" FLAG     00248
*                                                                       00249
OPENIT   BAL   R14,OPENIN           OPEN THE INPUT FILE                 00250
         OUTPT MINUS1,PROGRAM       PROGRAM NAME AND PURPOSE            00251
         OUTPT MINUS1,ABL           AUTHOR                              00252
         OUTPT MINUS1,BLANKS                                            00253
         MVC   WORK(4),=CL4'DSN='                                       00254
         MVC   WORK+4(44),JFCBDSNM  DATA SET NAME                       00255
         LA    R1,WORK+4                                                00256
         LA    R1,1(,R1)            SCAN FOR                            00257
         CLI   0(R1),X'40'                  FINAL                       00258
         BNE   *-8                               BLANK                  00259
         MVC   0(9,R1),=CL9',VOL=SER='                                  00260
         MVC   9(6,R1),JFCBVOLS     ADD THE VOLUME SERIAL               00261
         OUTPT MINUS1,WORK,LN=80                                        00262
         DCBCONV WORK               FORMAT THE DCB INFORMATION          00263
         OUTPT MINUS1,WORK,LN=80                                        00264
         L     R1,DCBDEBAD                                              00265
         L     R14,NUMEXT           NUMBER OF EXTENTS                   00266
         SR    R0,R0                                                    00267
         AH    R0,46(,R1)           TRACKS IN THE EXTENT                00268
         LA    R1,16(,R1)           OFFSET BETWEEN EXTENTS              00269
         BCT   R14,*-8              REPEAT FOR EACH EXTENT              00270
         ST    R0,TOTALTRK          SAVE TRACK TOTAL                    00271
         LH    R1,DS1LSTAR          LAST TT USED                        00272
         SR    R0,R1                AVAILABLE SPACE + 0.5 TRACKS        00273
         BCTR  R0,0                 SUBTRACT ONE MORE                   00274
         ST    R0,AVAILTRK                                              00275
         MVC   TEMP(4),DS1LSTAR                                         00276
         TTRMBB TEMP,MBB=LASTMBB  SAVE THE LAST USED MBBCCHHR           00277
         OUTPT TOTALTRK,NUMTRKS                                         00278
         OUTPT AVAILTRK,FRETRKS                                         00279
         MVC   TEMP(2),=H'0'                                            00280
         MVC   TEMP+2(2),DS1TRBAL                                       00281
         OUTPT TEMP,TRBALS        BYTES LEFT ON LAST USED TRACK         00282
         OUTPT NUMEXT,NUMEXTS                                           00283
         L     R2,DCBDEBAD                                              00284
         L     R3,NUMEXT                                                00285
         SR    R1,R1                                                    00286
         IC    R1,24(R2)                                                00287
         SRL   R1,4                                                     00288
         IC    R1,HEXTBL(R1)                                            00289
         STC   R1,PROTECT         PROTECTION KEY FOR THIS DATA SET      00290
         OUTPT MINUS1,PROTECT                                           00291
         TM    DS1SCALO,X'C0'                         CYLINDER ALLOC?   00292
         BNO   *+14                                   NO, BRANCH        00293
         MVC   SCALOS+25(9),=CL9'CYLINDERS'           YES               00294
         B     ALLOCS                                                   00295
         BNZ   *+14                                   ABS. TRACKS       00296
         MVC   SCALOS+25(15),=CL15'ABSOLUTE TRACKS'   YES               00297
         B     ALLOCS                                                   00298
         TM    DS1SCALO,X'80'                         TRACKS?           00299
         BNO   *+14                                   NO, BRANCH        00300
         MVC   SCALOS+25(6),=CL6'TRACKS'              YES               00301
         B     ALLOCS                                                   00302
         MVC   SCALOS+25(6),=CL6'BLOCKS'              BLOCKS            00303
         TM    DS1SCALO,X'01'                         ROUND TO CYL?     00304
         BNO   ALLOCS                                 NO, BRANCH        00305
         MVC   SCALOS+32(12),=CL12'(WITH ROUND)'      YES               00306
ALLOCS   OUTPT MINUS1,SCALOS                                            00307
         MVC   TEMP+1(3),DS1SAQU  SECONDARY ALLOCATION QUANTITY         00308
         MVI   TEMP,X'00'                                               00309
         CLC   TEMP,=F'0'         ANY SECONDARIES ALLOWED?              00310
         BNE   SECS               YES, BRANCH                           00311
         OUTPT MINUS1,NOSEC       NO                                    00312
         B     ALLSECS                                                  00313
SECS     OUTPT TEMP,EXTENTS                                             00314
*                                                                       00315
ALLSECS  SR    R4,R4              EXTENT NUMBER                         00316
         HEXES LASTMBB,8,LSTAR+13                                       00317
         OUTPT MINUS1,LSTAR       LAST USED MBBCCHHR                    00318
         OUTPT MINUS1,BLANKS                                            00319
         OUTPT MINUS1,EXTHDR                                            00320
         OUTPT MINUS1,EXTUND                                            00321
 EJECT                                                                  00322
HEXAGN   CVD   R4,DOUBLE                                                00323
         LA    R4,1(,R4)                                                00324
         UNPK  DOUBLE(5),DOUBLE+5(3)                                    00325
         MVC   WORK+1(2),DOUBLE+3                                       00326
         OI    WORK+2,X'F0'       EXTENT NUMBER                         00327
         CLI   WORK+1,X'F0'                                             00328
         BNE   *+8                                                      00329
         MVI   WORK+1,X'40'                                             00330
         L     R1,32(R2)          UCB ADDRESS                           00331
         MVC   WORK+8(3),13(R1)   UCB                                   00332
         HEXES 38(R2),4,WORK+14   INITIAL CCHH                          00333
         HEXES 42(R2),4,WORK+28   END     CCHH                          00334
         LH    R1,46(,R2)         NUMBER OF TRACKS IN THIS EXTENT       00335
         CVD   R1,DOUBLE                                                00336
         UNPK  DOUBLE(5),DOUBLE+5(3)                                    00337
         MVC   WORK+42(5),DOUBLE                                        00338
         LA    R1,WORK+41                                               00339
         LA    R1,1(,R1)                                                00340
         CLI   1(R1),C'0'         NEXT DIGIT ZERO?                      00341
         MVI   0(R1),X'40'        REPLACE CURRENT DIGIT WITH BLANK      00342
         BE    *-12               YES, CONTINE BLANKING LEADING ZEROES  00343
         OI    WORK+46,X'F0'      MAKE THE ZONE PRINTABLE               00344
         OUTPT MINUS1,WORK                                              00345
         LA    R2,16(,R2)         NEXT EXTENT DISPLACEMENT              00346
         BCT   R3,HEXAGN                                                00347
         OUTPT MINUS1,BLANKS                                            00348
*                                                                       00349
         SR    R0,R0                                                    00350
         IC    R0,DS1KEYL                                               00351
         LTR   R0,R0              KEYLENGTH=0?                          00352
         BZ    DSORGTST           YES, BRANCH                           00353
         OUTPT R0,KEYLEN          NO, OUTPUT KEYLEN AND RKP             00354
         MVC   TEMP+2(2),DS1RKP                                         00355
         OUTPT TEMP,KEYPOS                                              00356
         OUTPT MINUS1,BLANKS                                            00357
DSORGTST TM    FLAGS,LABELS       LABEL INFORMATION ONLY DESIRED?       00358
         BO    END3               YES, DO NOT DO ANY READS              00359
         TM    DS1DSORG,X'02'     PARTITIONED DATA SET ORGANIZATION?    00360
         BO    PO                 YES, BRANCH                           00361
 EJECT                            NO -- PS, DA OR IS                    00362
INPUTS   BAL   R14,EXCPSTAT       READ EACH BLOCK AND COLLECT STATS     00363
         LTR   R15,R15            END OF FILE?                          00364
         BZ    INPUTS             NO, CONTINUE READING                  00365
         LR    R2,R15             SAVE FOR LATER                        00366
         OUTPT MINUS1,EOFSS                                             00367
         TM    DS1DSORG,X'80'     ISAM?                                 00368
         BNO   ENDDATA            NO, BRANCH -- END OF DATA SET         00369
         CLC   MINBLKI,=F'33000'  EVER CHANGED?                         00370
         BNE   *+10               YES, BRANCH                           00371
         SR    R14,R14            NO, RESET TO ZERO                     00372
         ST    R14,MINBLKI                                              00373
         OUTPT MINBLKI,MINBLKS                                          00374
         LA    R14,1                                                    00375
         C     R14,READTOTI                                             00376
         BH    *+8                                                      00377
         L     R14,READTOTI    TAKE MAX OF READTOTI AND 1               00378
         L     R1,READTOTI                                              00379
         SRL   R1,1                                                     00380
         A     R1,BYTECNTI                                              00381
         SR    R0,R0                                                    00382
         DR    R0,R14          AVG BLK= (BYTECNTI + READTOTI/2) /       00383
         LR    R0,R1                     MAX( READTOTI, 1)              00384
         OUTPT R0,AVGBLKS                                               00385
         OUTPT MAXBLKI,MAXBLKS                                          00386
         OUTPT READTOTI,NUMBLKS                                         00387
         OUTPT MINUS1,BLANKS                                            00388
         MVC   MINBLKI,=F'33000' RESET                                  00389
         SR    R14,R14                THE                               00390
         ST    R14,READTOTI              FILE                           00391
         ST    R14,MAXBLKI                   STATISTICS                 00392
         ST    R14,BYTECNTI                            VARIABLES        00393
         C     R2,=F'5'           END OF DATA SET?                      00394
         BL    INPUTS             NO, REPORT ON THE NEXT SEGMENT        00395
*                                                                       00396
ENDDATA  L     R0,READTOT                                               00397
         LTR   R0,R0              ANY RECORDS READ?                     00398
         BP    ENDPSPO            YES, NORMAL DATA SET                  00399
         OUTPT MINUS1,NULL        NO RECORDS IN THE DATA SET            00400
         B     END3               QUIT                                  00401
*                                                                       00402
*                                                                       00403
PO       SR    R5,R5                CLEAR R5 FOR LATER                  00404
         OI    FLAGS,DIRECTOR       TURN ON THE "IN DIRECTORY" FLAG     00405
         CLI   DS1NOBDB,0           LAST DIRECTORY BLOCK IN USE?        00406
         BE    NEXTMBR              NO, BRANCH                          00407
         SR    R0,R0                                                    00408
         IC    R0,DS1NOBDB          NUMBER OF BYTES IN USE              00409
         ST    R0,TEMP                                                  00410
         OUTPT TEMP,NOBDBS                                              00411
 EJECT                                                                  00412
NEXTMBR  BAL   R14,MEMBERS          GET THE NEXT MEMBER                 00413
         B     *+4(R15)             BRANCH TABLE                        00414
         B     GOODMBR              SUCCESSFUL                          00415
         B     MBREOF               EOF IN DIRECTORY                    00416
         B     LASTUSED             LAST USED ENTRY FOUND               00417
         B     NOTDIREC             NOT A DIRECTORY RECORD              00418
*                                                                       00419
GOODMBR  LA    R2,ALIASES                                               00420
         TM    11(R1),X'80'          ALIAS ENTRY?                       00421
         BO    *+12                  YES, BRANCH                        00422
         LA    R2,REALMBR            NO, A REAL ENTRY                   00423
         NI    0(R1),X'7F'           TURN OFF THE TOP BIT IN THE NAME   00424
         L     R14,0(,R2)                                               00425
         LA    R14,1(,R14)           INCREMENT ALIASES OR REALMBR       00426
         ST    R14,0(,R2)                                               00427
         LR    R2,R1                                                    00428
         TTRMBB 8(R1),MBB=DOUBLE     CONVERT TTR TO MBBCCHHR            00429
         L     R1,=A(SAVETBL-16)                                        00430
TBLINC   LA    R1,16(,R1)                                               00431
         CLI   0(R1),X'40'           EMPTY TABLE ENTRY?                 00432
         BE    INSERT                YES, BRANCH                        00433
         CLC   8(8,R1),DOUBLE        IS IT THIS ENTRY?                  00434
         BNE   TBLINC                NO, CHECK NEXT ENTRY               00435
         TM    11(R2),X'80'          ALIAS?                             00436
         BO    NEXTMBR               YES, BRANCH                        00437
         MVC   0(8,R1),0(R2)         NO, USE THE REAL MEMBER NAME       00438
         B     NEXTMBR                                                  00439
INSERT   MVC   0(8,R1),0(R2)        INSERT THE NAME                     00440
         MVC   8(8,R1),DOUBLE       INSERT THE MBBCCHHR                 00441
         LR    R5,R1                SAVE THE "HIGH-WATER" MARK          00442
         L     R1,REALENT                                               00443
         LA    R1,1(,R1)            COUNT THE NUMBER OF TABLE ENTRIES   00444
         ST    R1,REALENT                                               00445
         C     R1,=F'4000'                                              00446
         BL    NEXTMBR                                                  00447
         OUTPT MINUS1,MANYENT                                           00448
         ABEND 99              ** TOO MANY MEMBER ENTRIES IN THE TABLE  00449
ALIAS    L     R1,ALIASES                                               00450
         LA    R1,1(,R1)             INCREMENT ALIAS MEMBER COUNT       00451
         ST    R1,ALIASES                                               00452
         B     NEXTMBR                                                  00453
NOTDIREC SR    R15,R15               SIMULATED END OF FILE (GOOD READ)  00454
MBREOF   L     R1,READTOT            END OF FILE IN DIRECTORY           00455
         ST    R1,USEDBLK            USED COUNT                         00456
         ST    R1,ALLOCBLK           ALLOCATED COUNT                    00457
         B     PRESORT                                                  00458
 EJECT                                                                  00459
LASTUSED L     R0,READTOT            END OF USED ENTRIES IN DIRECTORY   00460
         ST    R0,USEDBLK                                               00461
RPTEXCP  BAL   R14,EXCPSTAT          READ AND COLLECT STATISTICS        00462
         LTR   R15,R15                                                  00463
         BZ    RPTEXCP                                                  00464
         L     R1,READTOT                                               00465
         ST    R1,ALLOCBLK           ALLOCATED COUNT                    00466
PRESORT  SR    R0,R0                                                    00467
         XI    FLAGS,DIRECTOR        TURN OFF THE "IN DIRECTORY" FLAG   00468
         ST    R15,TEMP              SAVE FOR LATER                     00469
         ST    R0,READTOT            REINITIALIZE READTOT               00470
         ST    R0,MAXBLK                                 MAXBLK         00471
         ST    R0,BYTECNT                                      BYTECNT  00472
         MVC   MINBLK(4),=F'33000'   REINITIALIZE MINBLK                00473
*                                                                       00474
*     SORT THE MEMBER ARRAY BY MBBCCHHR  (USES A SHELLSORT)             00475
*                                                                       00476
         L     R2,REALENT           NUMBER OF ELEMENTS TO SORT          00477
         SLA   R2,4                 GAP IS  16 * ELEMENTS               00478
         L     R3,=A(SAVETBL-16)    TABLE BASE ADDRESS                  00479
         LR    R0,R2                N=GAP                               00480
SHELLG   SRL   R2,5                 GAP=GAP/2  (DROP FRACTION BITS)     00481
         SLA   R2,4                 GAP LESS THAN ONE?                  00482
         BZ    SORTED               YES, DONE                           00483
         LR    R4,R2                I=GAP                               00484
SHELLI   LA    R4,16(,R4)           I=I+1   (TABLE WIDTH IS 16)         00485
         CR    R4,R0                I<=N?                               00486
         BH    SHELLG               NO, HALVE THE GAP                   00487
         LR    R1,R4                YES, J=I                            00488
SHELLJ   SR    R1,R2                J=J-GAP                             00489
         BNP   SHELLI               IF J<=0, INCREMENT I                00490
         LA    R15,0(R3,R1)         ADDRESS OF SAVETBL(J)               00491
         LA    R14,0(R2,R1)         JG=J+GAP                            00492
         LA    R14,0(R3,R14)        ADDRESS OF SAVETBL(JG)              00493
         CLC   8(8,R15),8(R14)      MBBCCHHR(J) <= MBBCCHHR(JG)         00494
         BNH   SHELLI               YES, INCREMENT I                    00495
         XC    0(16,R14),0(R15)     INTERCHANGE                         00496
         XC    0(16,R15),0(R14)                SAVETBL ENTRIES          00497
         XC    0(16,R14),0(R15)                               J AND JG  00498
         B     SHELLJ               INCREMENT J                         00499
 EJECT                                                                  00500
SORTED   L     R2,=A(SAVETBL-16)                                        00501
         LTR   R5,R5                ANY MEMBERS?                        00502
         BZ    NULLPDS              NO, BRANCH                          00503
         MVC   LASTMEMS(8),0(R5)    LAST MEMBER IN THE PDS              00504
         OI    LASTMEMS,X'80'       MAKE PRINTABLE (IF REAL NAME)       00505
         OUTPT MINUS1,LASTMEMS                                          00506
NULLPDS  L     R15,TEMP             RESTORE THE RETURN CODE             00507
*                                                                       00508
NXTREAL  LA    R2,16(,R2)           LAST MEMBER WAS REAL                00509
NXTONE   L     R0,BYTECNT            LAST MEMBER WAS GAS                00510
         ST    R0,SAVETOT            SAVE FOR LATER                     00511
         C     R15,=F'8'             END OF DATA SET?                   00512
         BE    LASTMTCH              YES, BRANCH                        00513
         OI    FLAGS,REALONE         SET FLAG FOR ACTUAL MEMBER         00514
         MVC   CURRMBR(8),0(R2)      SAVE THE CURRENT MEMBER NAME       00515
         CLC   8(8,R2),IOBSEEK       NEXT MBBCCHHR IN THE TABLE?        00516
         BE    REALRD                YES, BRANCH TO READ LOOP           00517
         BH    NOABE13               NO, HIGHER -- A "GAS" MEMBER       00518
         OUTPT MINUS1,TTRTOLOW                                          00519
         ABEND 13            **  TABLED TTR < CURRENT TTR  **           00520
NOABE13  L     R1,GASCNT             NO, HIGHER -- A "GAS" MEMBER       00521
         LA    R1,1(,R1)                                                00522
         ST    R1,GASCNT             ADD ONE TO THE GAS MEMBER COUNT    00523
         XI    FLAGS,REALONE         TURN OFF THE ACTUAL MEMBER FLAG    00524
         TM    FLAGS,GAS             GAS RECORDS DESIRED?               00525
         BNO   GASRD                 NO, BRANCH                         00526
         MBBTTR IOBSEEK,TEMP         CONVERT MBBCCHHR TO TTRN           00527
         HEXES TEMP,3,GASMEM+21                                         00528
         TM    DS1RECFM,X'C0'        LRECL=U?                           00529
         BNO   DODATA                NO, BRANCH                         00530
         OUTPT MINUS1,GASMEM,LN=28   YES, DO NOT DO A DATA LINE         00531
         B     GASRD                                                    00532
*                                                                       00533
DODATA   OUTPT MINUS1,BLANKS                                            00534
         OUTPT MINUS1,GASMEM                                            00535
         BAL   R14,EXCPSTAT          INPUT THE NEXT REAL BLOCK          00536
         ST    R15,TEMP              SAVE THE RETURN CODE               00537
         L     R15,LS                                                   00538
         C     R15,=F'79'                                               00539
         BNH   *+8                                                      00540
         L     R15,=F'79'            LIMIT OUTPUT LENGTH TO 79 BYTES    00541
         LTR   R15,R15                                                  00542
         BNZ   *+12                                                     00543
         LA    R15,1                 IF NULL LENGTH, USE ONE BYTE AND   00544
         MVI   BUFFER,X'40'             BLANK THE FIRST BYTE OF BUFFER  00545
         OUTPT MINUS1,BUFFER,LN=0(R15)                                  00546
         L     R15,TEMP              RESTORE THE RETURN CODE            00547
         B     GASRDF                SKIP THE FIRST READ (ALREADY DONE) 00548
 EJECT                                                                  00549
GASRD    BAL   R14,EXCPSTAT          "GAS" MEMBER                       00550
         L     R1,GASRDS                                                00551
         LA    R1,1(,R1)             ADD ONE TO THE GAS RECORD COUNT    00552
         ST    R1,GASRDS                                                00553
GASRDF   LTR   R15,R15               (DON'T COUNT THE FIRST ONE)        00554
         BZ    GASRD                                                    00555
         L     R0,BYTECNT                                               00556
         S     R0,SAVETOT            GAS BYTES THIS MEMBER              00557
         L     R1,GASBYTE                                               00558
         AR    R1,R0                                                    00559
         ST    R1,GASBYTE            TOTAL GAS BYTES                    00560
         C     R0,MAXGAS                                                00561
         BNH   *+8                                                      00562
         ST    R0,MAXGAS             MAX BYTES/GAS MEMBER               00563
         C     R0,MINGAS                                                00564
         BNL   *+8                                                      00565
         ST    R0,MINGAS             MIN BYTES/GAS MEMBER               00566
         B     NXTONE                                                   00567
*                                                                       00568
REALRD   BAL   R14,EXCPSTAT          "REAL" MEMBER                      00569
REALRDF  LTR   R15,R15               END OF FILE?                       00570
         BZ    REALRD                NO, CONTINUE LOOPING               00571
         L     R0,BYTECNT                                               00572
         S     R0,SAVETOT                                               00573
         L     R1,RELBYTE                                               00574
         AR    R1,R0                                                    00575
         ST    R1,RELBYTE            TOTAL BYTES FOR REAL MEMBERS       00576
         C     R0,MAXREL                                                00577
         BNH   *+8                                                      00578
         ST    R0,MAXREL             MAX BYTES/REAL MEMBER              00579
         C     R0,MINREL                                                00580
         BNL   *+8                                                      00581
         ST    R0,MINREL             MIN BYTES/REAL MEMBER              00582
         B     NXTREAL                                                  00583
 EJECT                                                                  00584
LASTMTCH CLI   0(R2),X'40'                                              00585
         BE    ENDPSPO                                                  00586
         OUTPT MINUS1,NOTFOUND                                          00587
         ABEND 19            **  ALL MEMBERS IN THE TABLE NOT FOUND  ** 00588
ENDPSPO  OUTPT MINUS1,BLANKS                                            00589
         OUTPT MINR,MINRS                                               00590
         L     R15,TRACKNUM                                             00591
         SRL   R15,1                                                    00592
         A     R15,ALLR           (ALLR + TRACKNUM/2) / TRACKNUM        00593
         SR    R14,R14                                                  00594
         D     R14,TRACKNUM       AVERAGE RECORDS PER TRACK             00595
         LR    R0,R15                                                   00596
         OUTPT R0,AVGRS                                                 00597
         OUTPT MAXR,MAXRS                                               00598
         OUTPT MINUS1,BLANKS                                            00599
         L     R15,TRACKNUM                                             00600
         SRL   R15,1                                                    00601
         A     R15,TRKBYTE        (TRKBYTE + TRACKNUM/2) / TRACKNUM     00602
         SR    R14,R14                                                  00603
         D     R14,TRACKNUM       AVERAGE BYTES PER TRACK               00604
         ST    R15,AVGBTRK                                              00605
         OUTPT MINBYTE,MINBYTES   MIN BYTES/TRACK                       00606
         OUTPT AVGBTRK,AVGBYTES   AVG BYTES/TRACK                       00607
         OUTPT MAXBYTE,MAXBYTES   MAX BYTES/TRACK                       00608
         OUTPT MINUS1,BLANKS                                            00609
         OUTPT TRKBYTE,TOTBYTS    TOTAL DATA BYTES ON ALL TRACKS        00610
         OUTPT MINUS1,BLANKS                                            00611
         CLC   MINBLK,=F'33000'   EVER CHANGED?                         00612
         BNE   *+10               YES, BRANCH                           00613
         SR    R14,R14            NO, RESET TO ZERO                     00614
         ST    R14,MINBLK                                               00615
         OUTPT MINBLK,MINBLKS                                           00616
         LA    R14,1                                                    00617
         C     R14,READTOT                                              00618
         BH    *+8                                                      00619
         L     R14,READTOT     TAKE MAX OF READTOT AND 1                00620
         L     R1,READTOT                                               00621
         SRL   R1,1                                                     00622
         A     R1,BYTECNT                                               00623
         SR    R0,R0                                                    00624
         DR    R0,R14          AVG BLK= (BYTECNT + READTOT/2) /         00625
         LR    R0,R1                     MAX( READTOT, 1)               00626
         OUTPT R0,AVGBLKS                                               00627
         OUTPT MAXBLK,MAXBLKS                                           00628
         OUTPT MINUS1,BLANKS                                            00629
         OUTPT READTOT,NUMBLKS                                          00630
         TM    DS1DSORG,X'02'   DSORG=PO?                               00631
         BNO   END3                                                     00632
         OUTPT GASRDS,GASBLKS                                           00633
         OUTPT EOFS,ENDMBR                                              00634
         OUTPT GASCNT,GASMBR                                            00635
         L     R0,GASCNT                                                00636
         LTR   R0,R0                                                    00637
         BZ    NOGASM                                                   00638
         OUTPT MINUS1,BLANKS                                            00639
         OUTPT MINGAS,MINGASS     MIN BYTES PER GAS MEMBER              00640
         L     R15,GASCNT                                               00641
         SRL   R15,1                                                    00642
         A     R15,GASBYTE                                              00643
         SR    R14,R14                                                  00644
         D     R14,GASCNT                                               00645
         LR    R0,R15                                                   00646
         OUTPT R0,AVGGASS         AVG BYTES PER GAS MEMBER              00647
         OUTPT MAXGAS,MAXGASS     MAX BYTES PER GAS MEMBER              00648
         OUTPT MINUS1,BLANKS                                            00649
         L     R1,GASBYTE                                               00650
         LA    R15,100                                                  00651
         MR    R0,R15                                                   00652
         A     R1,=F'5'                                                 00653
         D     R0,AVGBTRK         TRKS*100 = (GASBYTE*100+5) / AVGBTRK  00654
         CVD   R1,DOUBLE             (DOES THE REQUIRED ROUNDING)       00655
         UNPK  GASTRK(9),DOUBLE+3(5)                                    00656
         MVC   GASTRK+8(1),GASTRK+7  MOVE TENS DIGIT OVER HUNDREDS      00657
         MVI   GASTRK+7,C'.'      MOVE IN THE DECIMAL POINT             00658
         LA    R1,GASTRK-1                                              00659
         LA    R1,1(,R1)          SCAN FOR                              00660
         CLI   0(R1),C'0'                 FIRST                         00661
         BE    *-8                             NON-ZERO                 00662
         CLI   0(R1),C'.'         WAS FIRST NON-ZERO THE PERIOD?        00663
         BNE   *+6                NO, BRANCH                            00664
         BCTR  R1,0               YES, BACK UP ONE CHARACTER            00665
         OUTPT MINUS1,0(R1)       OUTPUT GAS TRACK TOTAL                00666
NOGASM   OUTPT MINUS1,BLANKS                                            00667
         L     R0,EOFS                                                  00668
         S     R0,GASCNT                                                00669
         BNP   NOREAL                                                   00670
         ST    R0,TEMP                                                  00671
         OUTPT MINREL,MINRELS     MIN BYTES PER REAL MEMBER             00672
         L     R15,TEMP                                                 00673
         SRL   R15,1                                                    00674
         A     R15,RELBYTE                                              00675
         SR    R14,R14                                                  00676
         D     R14,TEMP                                                 00677
         LR    R0,R15                                                   00678
         OUTPT R0,AVGRELS         AVG BYTES PER MEMBER                  00679
         OUTPT MAXREL,MAXRELS     MAX BYTES PER MEMBER                  00680
         B     SOMEARE                                                  00681
NOREAL   OUTPT MINUS1,NOREALS                                           00682
SOMEARE  OUTPT MINUS1,BLANKS                                            00683
         OUTPT ALLOCBLK,ALLBLK                                          00684
         OUTPT USEDBLK,USEBLK                                           00685
         L     R1,REALMBR                                               00686
         A     R1,ALIASES                                               00687
         ST    R1,MINBLK                                                00688
         OUTPT MINBLK,USENAME                                           00689
         L     R1,ALIASES                                               00690
         LTR   R1,R1                                                    00691
         BZ    END3                                                     00692
         OUTPT ALIASES,ALSNAME                                          00693
         CLC   REALMBR,REALENT    ANY ALIASES WITHOUT REALS?            00694
         BE    END3               NO, DONE                              00695
         OUTPT MINUS1,BLANKS                                            00696
         BAL   R14,REREAD                                               00697
         L     R3,ALIASES                                               00698
TRYAGN   L     R2,=A(SAVETBL-16)                                        00699
         BAL   R14,MEMBERS                                              00700
         LTR   R15,R15                                                  00701
         BP    END3                                                     00702
         TM    11(R1),X'80'       ALIAS?                                00703
         BNO   TRYAGN             NO, GET THE NEXT ENTRY                00704
         MVC   ALNOREAL(8),0(R1)  PREPARE ERROR MESSAGE                 00705
         TTRMBB 8(R1),MBB=DOUBLE                                        00706
REALAGN  LA    R2,16(,R2)                                               00707
         CLC   8(8,R2),DOUBLE     CORRESPONDING TABLE ENTRY?            00708
         BNE   *-10               NO, TRY THE NEXT ONE                  00709
         TM    0(R2),X'80'        YES, ALIAS (IN THE TABLE)?            00710
         BNO   FOUNDIT                 NO, BRANCH                       00711
         OUTPT MINUS1,ALNOREAL         YES, ALIAS WITH NO REAL          00712
FOUNDIT  BCT   R3,TRYAGN                                                00713
 EJECT                                                                  00714
END3     CLOSE IN                 END POINT IF DSORG=PO, PS OR DA       00715
         TM    DS1DSORG,X'80'     ISAM DATA SET?                        00716
         BNO   ENDALL             NO, BRANCH                            00717
         OI    JFCBTSDM,X'08'     PREVENT REVERSE MERGE TO JFCB         00718
         MVI   JFCBDSNM,X'04'     SET-UP DSNAME FOR                     00719
         MVC   JFCBDSNM+1(43),JFCBDSNM             FORMAT 4 DSCB        00720
         OPEN  (IN,INPUT),TYPE=J  DO AN OPEN JFCB                       00721
         TM    DCBOFLGS,X'10'     OPENED CORRECTLY?                     00722
         BZ    ABE40              NO, QUIT                              00723
         BAL   R14,REREAD                                               00724
         MVC   IOBSEEK+3(5),DS1PTRDS  POINTER TO FORMAT 2 DSCB          00725
         BAL   R14,EXCP           READ THE FORMAT 2 DSCB                00726
         LTR   R15,R15                                                  00727
         BZ    NOABE11                                                  00728
         OUTPT MINUS1,NODSCB2     FORMAT 2 DSCB NOT READ CORRECTLY      00729
         ABEND 11                                                       00730
NOABE11  OUTPT MINUS1,BLANKS                                            00731
         OUTPT MINUS1,DSCB2                                             00732
         SR    R0,R0                                                    00733
         IC    R0,DS2NOLEV                                              00734
         ST    R0,TEMP                                                  00735
         OUTPT R0,DSSNOLEV         INDEX LEVELS                         00736
         MVC   TEMP+3(1),DS2DVIND                                       00737
         OUTPT TEMP,DSSDVIND       TRACKS FOR MASTER INDEX              00738
         MVC   TEMP+3(1),DS2CYLOV                                       00739
         OUTPT TEMP,DSSCYLOV       TRACKS OF CYL. OVERFLOW PER CYLINDER 00740
         MVC   TEMP+2(2),DS2TAGDT                                       00741
         OUTPT TEMP,DSSTAGDT       TAGGED FOR DELETION                  00742
         MVC   TEMP+1(3),DS2RORG3                                       00743
         OUTPT TEMP,DSSRORG3       OVERFLOW RECORD ACCESSES             00744
         LH    R0,DS2NOBYT                                              00745
         OUTPT R0,DSSNOBYT         CORE TO HOLD THE HIGHEST INDEX       00746
         SR    R0,R0                                                    00747
         IC    R0,DS2NOTRK                                              00748
         OUTPT R0,DSSNOTRK         TRACKS OCCUPIED BY THE HIGHEST INDEX 00749
         MVC   TEMP(4),DS2PRCTR                                         00750
         OUTPT TEMP,DSSPRCTR       RECORDS IN THE PRIME AREA            00751
         LH    R0,DS2BYOVL                                              00752
         OUTPT R0,DSSBYOVL         BYTES LEFT ON CUR. IND. OVER. TRACK  00753
         LH    R0,DS2RORG2                                              00754
         OUTPT R0,DSSRORG2         TRACKS LEFT IN IND. OVERFLOW AREA    00755
         LH    R0,DS2OVRCT                                              00756
         OUTPT R0,DSSOVRCT         RECORDS IN THE OVERFLOW AREA         00757
         LH    R0,DS2RORG1                                              00758
         OUTPT R0,DSSRORG1         CYLINDER OVERFLOW AREAS (FULL)       00759
         CLOSE IN                                                       00760
*                                                                       00761
ENDALL   CLOSE OUT                                                      00762
         L     R13,4(R13)                                               00763
         RETURN (14,12),RC=0                                            00764
         EJECT                                                          00765
EXCPSTAT ST    R14,STATR14    ISSUES EXCP'S AND GATHERS STATISTICS      00766
         BAL   R14,EXCP                                                 00767
         B     *+4(R15)                                                 00768
         B     R15IS0             GOOD READ                             00769
         B     R15IS4             END OF FILE OR END OF MEMBER          00770
         B     R15IS8             END OF DATA SET                       00771
R15IS12  OUTPT MINUS1,BLANKS      I/O OR OTHER DISK ERROR               00772
         L     R14,INAROW                                               00773
         LA    R14,1(,R14)        UPDATE NUMBER OF CONSECUTIVE ERRORS   00774
         ST    R14,INAROW                                               00775
         C     R14,=F'10'         ALLOW ONLY 10 CONSECUTIVE ERRORS      00776
         BL    CONTINUE                                                 00777
         OUTPT MINUS1,TOOMANY     TOO MANY CONSECUTIVE ERRORS           00778
         ABEND 999                                                      00779
CONTINUE HEXES SAVECB,1,IOERROR+17    ECB ERROR CODE                    00780
         HEXES CURMBB+3,5,IOERROR+27  CURRENT DISK CCHHR                00781
         OUTPT MINUS1,IOERROR                                           00782
         TM    DS1DSORG,X'02'     PDS?                                  00783
         BNO   BLKNUM             NO, BRANCH                            00784
         TM    FLAGS,DIRECTOR     ERROR IN THE DIRECTORY?               00785
         BO    DIRERR             YES, BRANCH                           00786
         TM    FLAGS,REALONE      ACTUAL MEMBER?                        00787
         BNO   GASERR             NO, BRANCH                            00788
         OI    CURRMBR,X'80'      MAKE PRINTABLE                        00789
         OUTPT MINUS1,CURRMBR     OUTPUT THE CURRENT MEMBER NAME        00790
         B     R15IS4$                                                  00791
GASERR   OUTPT MINUS1,GASERRS     ERROR IN READING GAS DATA             00792
         B     R15IS4$                                                  00793
DIRERR   OUTPT MINUS1,DIRERRS     DIRECTORY I/O ERROR (IGNORE BLOCK)    00794
BLKNUM   OUTPT READTOT,BLKNUMS    READ ERROR MESSAGE                    00795
         B     EXCPSTAT+4         CONTINUE--USING THE NEXT BLOCK        00796
*                                                                       00797
R15IS8   DS    0H                 END OF DATA SET                       00798
         B     TRKNOINC           FINISH UP PROCESSING                  00799
*                                                                       00800
R15IS4   MVC   INAROW,=F'0'       END OF MEMBER                         00801
R15IS4$  LA    R15,4              TREAT AS AN END OF MEMBER CONDITION   00802
         L     R1,EOFS                                                  00803
         LA    R1,1(,R1)          END OF MEMBER COUNTER                 00804
         ST    R1,EOFS                                                  00805
         CLC   MBBCCHH(7),CURMBB  NEW TRACK                             00806
         BNE   RETURNS                                                  00807
         L     R1,LASTR                                                 00808
         LA    R1,1(,R1)                                                00809
         ST    R1,LASTR           UPDATE THE RECORD COUNT               00810
         B     RETURNS                                                  00811
*                                                                       00812
R15IS0   MVC   INAROW,=F'0'       GOOD READ                             00813
R15IS0$  L     R1,READTOT                                               00814
         LA    R1,1(,R1)                                                00815
         ST    R1,READTOT         COUNT OF BLOCKS READ                  00816
         L     R1,LS              CURRENT BLKSIZE                       00817
         LR    R0,R1              SAVE FOR LATER                        00818
         C     R1,MINBLK                                                00819
         BH    *+8                                                      00820
         ST    R1,MINBLK          MINIMUM LENGTH BLOCK READ             00821
         C     R1,MAXBLK                                                00822
         BL    *+8                                                      00823
         ST    R1,MAXBLK          MAXIMUM LENGTH BLOCK READ             00824
         A     R1,BYTECNT                                               00825
         ST    R1,BYTECNT         TOTAL NUMBER OF BYTES READ            00826
         TM    DS1DSORG,X'80'     ISAM DATA SET?                        00827
         BNO   NOFILSUM           NO, BRANCH                            00828
         L     R1,READTOTI                                              00829
         LA    R1,1(,R1)                                                00830
         ST    R1,READTOTI        COUNT OF BLOCKS READ                  00831
         LR    R1,R0              CURRENT BLKSIZE                       00832
         C     R1,MINBLKI                                               00833
         BH    *+8                                                      00834
         ST    R1,MINBLKI         MINIMUM LENGTH BLOCK READ             00835
         C     R1,MAXBLKI                                               00836
         BL    *+8                                                      00837
         ST    R1,MAXBLKI         MAXIMUM LENGTH BLOCK READ             00838
         A     R1,BYTECNTI                                              00839
         ST    R1,BYTECNTI        TOTAL NUMBER OF BYTES READ            00840
NOFILSUM CLC   MBBCCHH(7),CURMBB  SAME MBBCCHH?                         00841
         BNE   NEWTRACK           NO, BRANCH                            00842
         A     R0,CURBYTE                                               00843
         ST    R0,CURBYTE         ACCUMULATE TRACK BYTE COUNT           00844
         L     R1,LASTR                                                 00845
         LA    R1,1(,R1)                                                00846
         ST    R1,LASTR           ACCUMULATE RECORD COUNT/TRACK         00847
         B     RETURNS                                                  00848
*                                                                       00849
NEWTRACK L     R1,TRACKNUM        SWITCH TRACKS --                      00850
         LA    R1,1(,R1)                                                00851
         ST    R1,TRACKNUM        ACTUAL TRACKS USED                    00852
TRKNOINC MVC   MBBCCHH(7),CURMBB  SAVE CURRENT TRACK NUMBER             00853
         L     R0,CURBYTE                                               00854
         L     R1,LS                                                    00855
         ST    R1,CURBYTE                                               00856
         L     R1,TRKBYTE                                               00857
         AR    R1,R0                                                    00858
         ST    R1,TRKBYTE         COUNT OF ALL CHARACTERS READ          00859
         L     R1,LASTR                                                 00860
         LA    R14,1                                                    00861
         ST    R14,LASTR                                                00862
         L     R14,ALLR                                                 00863
         AR    R14,R1                                                   00864
         ST    R14,ALLR           COUNT OF ALL READS                    00865
         LTR   R0,R0              FIRST ENTRY HERE?                     00866
         BNP   NOMINS             YES, BRANCH                           00867
         C     R0,MINBYTE                                               00868
         BNL   *+8                                                      00869
         ST    R0,MINBYTE         MIN BYTES/TRACK                       00870
         C     R1,MINR                                                  00871
         BNL   *+8                                                      00872
         ST    R1,MINR            MIN RECORD NUMBER/TRACK               00873
NOMINS   C     R0,MAXBYTE                                               00874
         BNH   *+8                                                      00875
         ST    R0,MAXBYTE         MAX BYTES/TRACK                       00876
         C     R1,MAXR                                                  00877
         BNH   *+8                                                      00878
         ST    R1,MAXR            MAX RECORD NUMBER/TRACK               00879
*                                                                       00880
RETURNS  L     R14,STATR14                                              00881
         BR    R14                                                      00882
         EJECT                                                          00883
*                                                                       00884
*   MEMBER INPUT ROUTINE                                                00885
*                                                                       00886
*                                                                       00887
MEMBERS  ST    R14,MEMBR14                                              00888
         LM    R15,R1,DIRPTRS     PICK UP ADDR, INCR, LIMIT             00889
         LTR   R1,R1              INITIALIZED?                          00890
         BNZ   DEBLOCK            YES, BRANCH                           00891
         BAL   R14,REREAD         OPEN IN FOR INPUT OF THE DIRECTORY    00892
GETBLK   BAL   R14,EXCPSTAT       GET A DIRECTORY BLOCK                 00893
         LTR   R15,R15            END OF FILE?                          00894
         BP    MBRDONE            YES, END OF FILE INDICATION           00895
         CLC   LS+2(2),=H'256'    GOOD DIRECTORY BLOCK?                 00896
         BNE   NODIRBLK           NO, BRANCH                            00897
         LA    R0,2               INCREMENT IS 2 FIRST                  00898
         LH    R1,BUFFER          LENGTH HALFWORD                       00899
         LA    R1,BUFFER-1(R1)    LIMIT                                 00900
         LA    R15,BUFFER         START                                 00901
DEBLOCK  BXH   R15,R0,GETBLK                                            00902
         IC    R0,11(,R15)                                              00903
         N     R0,=F'31'          GET LENGTH BITS                       00904
         AR    R0,R0              LENGTH * 2                            00905
         A     R0,=F'12'          LENGTH * 2  +  12                     00906
         STM   R15,R1,DIRPTRS     SAVE FOR LATER                        00907
         CLI   0(R15),X'FF'       LAST MEMBER                           00908
         BNE   *+12               NO, BRANCH                            00909
         LA    R15,8              LAST MEMBER USED INDICATION           00910
         B     MBRDONE                                                  00911
         LR    R1,R15             ADDRESS OF MEMBER NAME (RETURNED)     00912
         SR    R15,R15            GOOD READ INDICATION                  00913
         B     MBRDONE                                                  00914
NODIRBLK OUTPT MINUS1,EOFSIMS     RECORD LENGTH IS NOT 256              00915
         OUTPT LS,BLOCKLEN        OUTPUT CURRENT LRECL                  00916
         LA    R15,12             ERROR INDICATION                      00917
MBRDONE  L     R14,MEMBR14        RETURN ADDRESS                        00918
         BR    R14                                                      00919
DIRPTRS  DC    3A(0)              SAVEAREA FOR R15, R0 AND R1           00920
MEMBR14  DC    A(0)               SAVEAREA FOR RETURN ADDRESS           00921
         EJECT                                                          00922
*                                                                       00923
*   EXCP SUBROUTINES  (OPENIN, REREAD AND EXCP)                         00924
*                                                                       00925
*                                                                       00926
*   OPENS THE FILE WITH DDNAME IN                                       00927
*                                                                       00928
OPENIN   ST    R14,EXCPR14                  ENTRY TO OPEN THE IN FILE   00929
         RDJFCB (IN)                        GET DSN AND VOLUME SERIAL   00930
         LTR   R15,R15                      SUCCESSFUL?                 00931
         BZ    NOABE40                      YES, BRANCH                 00932
ABE40    OUTPT MINUS1,NOTOPEN                                           00933
         ABEND 40                  ** RDJFCB, OBTAIN OR OPEN FAILED **  00934
NOABE40  OBTAIN MYLABEL                     READ IN THE FORMAT 1 DSCB   00935
         LTR   R15,R15                      SUCCESSFUL?                 00936
         BNZ   ABE40                        NO, STOP THE PROGRAM        00937
         OPEN  (IN,INPUT)                                               00938
         TM    DCBOFLGS,X'10'               IN OPEN?                    00939
         BZ    ABE40                        NO, STOP THE PROGRAM        00940
         B     REREAD+4                                                 00941
*                                                                       00942
*                                                                       00943
*   ENTRY TO REREAD THE OPEN DATA SET (DDNAME IS IN)                    00944
*                                                                       00945
REREAD   ST    R14,EXCPR14                                              00946
         L     R1,DCBDEBAD                                              00947
         SR    R14,R14                                                  00948
         IC    R14,16(R1)                   NUMBER OF EXTENTS           00949
         ST    R14,NUMEXT                   SAVE FOR LATER              00950
         LA    R14,16(R1)                   CURRENT EXTENT POINTER - 16 00951
         ST    R14,CUREXT                   SAVE FOR LATER              00952
         MVI   IOBSEEK,X'00'                RESET THE EXTENT NUMBER     00953
         LA    R15,4                        EARLY EXIT FLAG             00954
         B     FIRSTONE                     DO THE INITIAL EXTENT       00955
*                                                                       00956
*                                                                       00957
*                                                                       00958
*    FOR EACH EXTENT, INITIALIZE CCHHR, SECTOR NUMBER AND READ IN THE   00959
*        LENGTH OF THE FIRST RECORD.                                    00960
*                                                                       00961
EACHXTNT SR    R1,R1              AFTER THE FIRST EXTENT --             00962
         IC    R1,IOBSEEK                                               00963
         LA    R1,1(,R1)                                                00964
         STC   R1,IOBSEEK         INCREMENT THE EXTENT NUMBER           00965
         C     R1,NUMEXT          PAST LAST EXTENT?                     00966
         BNL   EOF$DS             YES, NO END OF DATA SET RECORDED      00967
*                                                                       00968
FIRSTONE ST    R15,EXCPR15                  SAVE ENTRY CODE FOR LATER   00969
         L     R1,CUREXT                                                00970
         LA    R1,16(R1)                    CURRENT EXTENT ENTRY        00971
         MVC   IOBSEEK+3(4),6(R1)           INITIAL CCHH                00972
         ST    R1,CUREXT                    UPDATE FOR LATER            00973
         MVI   IOBSEEK+7,0                                              00974
         MVI   SNO,0                        SET SECTOR NUMBER=ZERO      00975
         LA    1,CCW1A                                                  00976
         ST    1,CPADDR                                                 00977
         EXCP  IOB                                                      00978
         WAIT  ECB=ECB                                                  00979
         CLI   ECB,X'7F'                    GOOD READ?                  00980
         BE    NOABE30                      YES, BRANCH                 00981
         OUTPT MINUS1,FIRSTRD                                           00982
         ABEND 30          **  FIRST READ OF EXTENT DID NOT WORK  **    00983
NOABE30  LA    R1,CCW1                                                  00984
         ST    R1,CPADDR                                                00985
         MVC   CCW3+6(2),DATALN             GET LENGTH FOR NEXT READ    00986
         MVI   IOBSEEK+7,1                  SET R=1                     00987
         L     R15,EXCPR15                                              00988
         LTR   R15,R15                      EARLY EXIT DESIRED?         00989
         BZ    EXCP+4                       NO, ISSUE THE EXCP AGAIN    00990
         L     R14,EXCPR14          RETURN FROM OPENIN, REREAD OR       00991
         BR    R14                      AFTER EOF AND EXTENT VIOLATION  00992
*                                                                       00993
*   ENTRY FOR EACH EXCP TO BE PERFORMED                                 00994
*                                                                       00995
EXCP     ST    R14,EXCPR14                                              00996
         CLI   ECB,X'42'                    EXTENT VIOLATION LAST TIME? 00997
         BE    EACHXTNT                     YES, DO THE NEXT EXTENT     00998
         MVC   CURMBB(8),IOBSEEK  SAVE THE DISK ADDRESS OF THIS RECORD  00999
         MVC   LS+2(2),DATALN     SAVE THE BLOCK LENGTH FOR THIS READ   01000
         EXCP  IOB                                                      01001
         WAIT  ECB=ECB                                                  01002
         SR    R15,R15            GOOD READ FLAG                        01003
         CLI   ECB,X'42'          EXTENT VIOLATION (NEXT TIME)?         01004
         BE    ENDEXCP            YES, QUIT                             01005
         TM    DS1DSORG,X'80'     ISAM DATA SET?                        01006
         BO    *+14               YES, IGNORE DS1LSTAR CHECK FOR ISAM   01007
         CLC   LASTMBB(8),CURMBB  PAST THE DS1LSTAR MARKER?             01008
         BNH   EOF$DS             YES, END OF FILE AND DATA SET         01009
         CLI   ECB,X'7F'          GOOD READ?                            01010
         BE    ENDEXCP            YES, QUIT                             01011
*                                                                       01012
         CLI   ECB,X'41'          PERMANENT ERROR?                      01013
         BE    NOABE10            YES, BRANCH                           01014
         OUTPT MINUS1,BADERROR                                          01015
         B     SOMERR         **  BAD ERROR; ECB NOT HEX 41, 42 OR 7F   01016
NOABE10  TM    CSW+4,X'01'        ACTUALLY EOF?                         01017
         BO    EOF                                                      01018
         CLC   CSW+4(4),=X'00200000'  NULL MEMBER OR DATA SET?          01019
         BE    EOF                    YES, BRANCH                       01020
         OUTPT MINUS1,PERMERR                                           01021
SOMERR   LA    R15,12         **  PERMANENT ERROR--NOT END OF FILE  **  01022
         MVC   SAVECB(1),ECB      SAVE ECB CODE FOR LATER               01023
         B     REISSUE                                                  01024
*                                                                       01025
EOF      TM    DS1DSORG,X'60'     DSORG=PS OR DA?                       01026
         BNZ   EOF$DS             YES, END OF FILE AND DATA SET         01027
         LA    R15,4              END OF MEMBER FLAG                    01028
         CLC   =H'0',DATALN       NEXT BLOCK LENGTH = 0?                01029
         BNE   ENDEXCP            NO, BRANCH                            01030
REISSUE  ST    R15,EXCPR15                                              01031
         LA    R1,CCW1A           NEED TO REISSUE THE INITIALIZATION    01032
         ST    R1,CPADDR                EXCP TO GET LENGTH AND ADDRESS  01033
         EXCP  IOB                      OF THE NEXT DATA BLOCK          01034
         WAIT  ECB=ECB                                                  01035
         L     R15,EXCPR15        READ ERROR (12) OR END OF MEMBER (4)  01036
         LA    R1,CCW1                                                  01037
         ST    R1,CPADDR                                                01038
         MVC   CCW3+6(2),DATALN   DATALENGTH FOR NEXT EXCP              01039
         CLI   ECB,X'42'          EXTENT VIOLATION?                     01040
         BE    EACHXTNT           YES, DO THE NEXT EXTENT -- EARLY EXIT 01041
         CLI   ECB,X'7F'          GOOD READ?                            01042
         BE    ENDEXCP            YES, QUIT                             01043
         CLI   ECB,X'41'          PERMANENT ERROR?                      01044
         BE    NOABE70            YES, CHECK EOF                        01045
ABE70    OUTPT MINUS1,BADERROR                                          01046
         ABEND 70             **  SOME OTHER BAD ERROR  **              01047
NOABE70  TM    CSW+4,X'01'        NULL MEMBER (ANOTHER EOF)?            01048
         BO    ENDEXCP                                                  01049
ABE80    OUTPT MINUS1,PERMERR                                           01050
         ABEND 80             **  PERMANENT ERROR AFTER EOF  **         01051
EOF$DS   LA    R15,8              END OF FILE AND DATA SET FLAG         01052
ENDEXCP  L     R14,EXCPR14        RETURN ADDRESS                        01053
         BR    R14                                                      01054
         EJECT                                                          01055
*                                                                       01056
*   OUTPUT ROUTINE                                                      01057
*      NOTE: R0 NEGATIVE IF NO NUMERIC OUTPUT; OTHERWISE OUTPUT NUMERIC 01058
*            R1 CONTAINS THE ADDRESS OF THE STRING TO OUTPUT            01059
*            R14 CONTAINS THE RETURN ADDRESS                            01060
*            R15 CONTAINS THE LENGTH OF THE STRING                      01061
*                                                                       01062
OUTRTN   ST    R14,RETOUT                                               01063
         BCTR  R15,0                  MACHINE LENGTH                    01064
         MVC   OUTLINE+10(*-*),0(R1)   <<EXECUTED>>                     01065
         EX    R15,*-6                MOVE IN THE STRING                01066
         LTR   R0,R0                  ANY LEADING NUMERICS?             01067
         LA    R1,OUTLINE+10                                            01068
         BM    OUTSTMT                NO, BRANCH                        01069
         CVD   R0,DOUBLE                                                01070
         UNPK  OUTLINE(9),DOUBLE+3(5) ASSUME NO MORE THAN 9 DIGITS      01071
         LA    R1,OUTLINE-1                                             01072
         LA    R1,1(,R1)              SCAN FOR                          01073
         CLI   0(R1),C'0'                     FIRST                     01074
         BE    *-8                                 NON-ZERO             01075
         OI    OUTLINE+8,X'F0'        MAKE THE LAST DIGIT PRINTABLE     01076
OUTSTMT  TM    DCBOFLGS-IHADCB+OUT,X'10'  OUT OPEN?                     01077
         BO    OUTNOW                     YES, BRANCH TO PUT            01078
         ST    R1,SAVER1                  SAVE R1                       01079
         OPEN  (OUT,OUTPUT)               OPEN                          01080
         L     R1,SAVER1                  RESTORE R1                    01081
         TM    DCBOFLGS-IHADCB+OUT,X'10'  OPEN NOW?                     01082
         BO    OUTNOW                     YES, BRANCH                   01083
         WTO   'DDNAME "OUT" COULD NOT BE OPENED',ROUTCDE=(11)          01084
         ABEND 69            ** OUTPUT FILE DID NOT OPEN  **            01085
OUTNOW   LR    R0,R1                                                    01086
         PUT   OUT,(0)                OUTPUT THE LINE                   01087
         MVI   OUTLINE,X'40'                                            01088
         MVC   OUTLINE+1(89),OUTLINE  BLANK IT                          01089
         L     R14,RETOUT             RETURN                            01090
         BR    R14                                                      01091
RETOUT   DC    A(0)                   SAVEAREA FOR RETURN ADDRESS       01092
SAVER1   DC    A(0)                   SAVEAREA FOR R1 DURING OPEN       01093
OUTLINE  DC    CL90' '                                                  01094
         EJECT                                                          01095
CCW1A    CCW   X'31',IOBSEEK+3,X'60',5      SEARCH ID EQUAL (CCHHR)     01096
CCW2A    CCW   X'08',*-8,X'60',1            TIC                         01097
CCW3A    CCW   X'92',IOBSEEK+3,X'20',8      MT READ NEXT COUNT          01098
*                                                                       01099
CCW0     CCW   X'23',SNO,X'60',1            SET SECTOR                  01100
CCW1     CCW   X'31',IOBSEEK+3,X'60',5      SEARCH ID EQUAL (CCHHR)     01101
CCW2     CCW   X'08',*-8,X'60',1            TIC                         01102
CCW3     CCW   X'06',BUFFER,X'60',32760     READ DATA                   01103
CCW4     CCW   X'92',IOBSEEK+3,X'60',8      MT READ NEXT COUNT          01104
CCW5     CCW   X'22',SNO,X'20',1            READ SECTOR NUMBER          01105
*                                                                       01106
         DS    0F                                                       01107
IOB      DC    X'C2000000'                                              01108
         DC    A(ECB)                                                   01109
CSW      DC    2A(0)                                                    01110
CPADDR   DC    A(CCW1)                                                  01111
         DC    A(IN)                                                    01112
         DC    2A(0)                                                    01113
IOBSEEK  DC    2A(0)          NEXT MBBCCHHR ADDRESS                     01114
KEYLN    DS    X              NEXT KEYLENGTH                            01115
DATALN   DS    2X             NEXT RECORD LENGTH                        01116
SNO      DC    X'00'          NEXT SECTOR NUMBER                        01117
*                                                                       01118
CURMBB   DC    CL8' '         CURRENT MBBCCHHR ADDRESS                  01119
MBBCCHH  DC    CL7' '         SAVE AREA FOR MBBCCHH                     01120
*                                                                       01121
ECB      DC    F'0'           ECB                                       01122
LS       DC    F'0'           LENGTH OF THE CURRENT RECORD              01123
FLAGS    DC    X'01'                      FLAG BYTE                     01124
GAS      EQU   X'01'                      GAS RECORDS DESIRED (DEFAULT) 01125
LABELS   EQU   X'02'                      LABELS ONLY (NO DATA READ)    01126
REALONE  EQU   X'40'                      ERROR IN ACTUAL MEMBER FLAG   01127
DIRECTOR EQU   X'80'                      ERROR IN DIRECTORY RECORDS    01128
SAVECB   DC    X'00'                      SAVE AREA FOR ECB             01129
SAVE     DC    18F'0'                     SAVE AREA                     01130
LASTR    DC    F'0'                       CURRENT NUMBER OF RECORDS/TRK 01131
EXCPR14  DC    F'0'                       RETURN REGISTER FOR EXCP      01132
EXCPR15  DC    F'0'                       EXIT FLAG REGISTER SAVEAREA   01133
STATR14  DC    F'0'                       RETURN REGISTER FOR EXCPSTAT  01134
CUREXT   DC    F'0'                       ADDRESS OF THE CURRENT EXTENT 01135
NUMEXT   DC    F'0'                       TOTAL EXTENTS IN THE DATA SET 01136
READTOT  DC    F'0'                       TOTAL RECORDS READ            01137
MINBLK   DC    F'33000'                   MINIMUM LENGTH BLOCK          01138
MAXBLK   DC    F'0'                       MAXIMUM LENGTH BLOCK          01139
BYTECNT  DC    F'0'                       TOTAL BYTES READ              01140
READTOTI DC    F'0'                       TOTAL RECORDS READ (ISAM)     01141
MINBLKI  DC    F'33000'                   MINIMUM LENGTH BLOCK (ISAM)   01142
MAXBLKI  DC    F'0'                       MAXIMUM LENGTH BLOCK (ISAM)   01143
BYTECNTI DC    F'0'                       TOTAL BYTES READ (ISAM)       01144
TEMP     DC    F'0'                       WORK STORAGE                  01145
GASBYTE  DC    F'0'                       TOTAL BYTES IN GAS MEMBERS    01146
RELBYTE  DC    F'0'                       TOTAL BYTES IN REAL MEMBERS   01147
MINGAS   DC    X'7F000000'                MIN BYTES IN GAS MEMBERS      01148
MAXGAS   DC    F'0'                       MAX BYTES IN GAS MEMBERS      01149
MINREL   DC    X'7F000000'                MIN BYTES IN REAL MEMBERS     01150
MAXREL   DC    F'0'                       MAX BYTES IN REAL MEMBERS     01151
SAVETOT  DC    F'0'                       STARTING BYTE COUNT HOLD      01152
MAXR     DC    F'0'                       MAXIMUM RECORDS/TRACK         01153
MINR     DC    F'255'                     MINIMUM RECORDS/TRACK         01154
TRKBYTE  DC    F'0'                       SUM OF ALL BLOCKSIZES         01155
INAROW   DC    F'0'                       NUMBER OF CONSECUTIVE ERRORS  01156
ALLR     DC    F'0'                       SUM OF ALL RECORDS READ       01157
CURBYTE  DC    F'0'                       CURRENT TRACK BYTE COUNT      01158
MAXBYTE  DC    F'0'                       MAXIMUM BYTES/TRACK           01159
MINBYTE  DC    X'7F000000'                MINIMUM BYTES/TRACK           01160
TRACKNUM DC    F'0'                       ACTUAL COUNT OF TRACKS USED   01161
MINUS1   DC    F'-1'                      NO NUMERIC OUTPUT FLAG        01162
EOFS     DC    F'0'                       COUNT OF END OF FILES         01163
GASCNT   DC    F'0'                       NUMBER OF "GAS" MEMBERS       01164
GASRDS   DC    F'0'                       NUMBER OF "GAS" RECORDS       01165
AVGBTRK  DC    F'0'                       AVERAGE BYTES PER TRACK       01166
AVAILTRK DC    F'0'                       FREE TRACKS                   01167
TOTALTRK DC    F'0'                       TOTAL TRACKS                  01168
ALIASES  DC    F'0'                       ALIASES IN THE DIRECTORY      01169
REALMBR  DC    F'0'                       REAL ENTRIES (DIRECTORY)      01170
REALENT  DC    F'0'                       MEMBER TABLE ENTRIES          01171
ALLOCBLK DC    F'0'                       DIRECTORY BLOCKS ALLOCATED    01172
USEDBLK  DC    F'0'                       DIRECTORY BLOCKS USED         01173
*                                                                       01174
PROGRAM  DC    CL50'STATDS  --  DISK DATA SET STATISTICS PROGRAM      ' 01175
ABL      DC    CL50'                       WRITTEN BY  A. BRUCE LELAND' 01176
NODSCB2  DC    CL50'THE ISAM LABEL RECORD COULD NOT BE INPUT          ' 01177
DSCB2    DC    CL50'THE FOLLOWING DATA IS FROM THE ISAM LABEL RECORD: ' 01178
DSSNOLEV DC    CL50'INDEX LEVELS PRESENT IN THIS DATA SET             ' 01179
DSSDVIND DC    CL50'TRACKS FOR EACH MASTER INDEX                      ' 01180
DSSCYLOV DC    CL50'TRACKS OF CYLINDER OVERFLOW AREA ON EACH CYLINDER ' 01181
DSSTAGDT DC    CL50'RECORDS TAGGED FOR DELETION                       ' 01182
DSSRORG3 DC    CL50'OVERFLOW ACCESSES (NOT COUNTING FIRST IN CHAIN)   ' 01183
DSSNOBYT DC    CL50'BYTES NEEDED TO HOLD THE HIGHEST INDEX IN CORE    ' 01184
DSSNOTRK DC    CL50'TRACKS OCCUPIED BY THE HIGHEST-LEVEL INDEX        ' 01185
DSSPRCTR DC    CL50'RECORDS IN THE PRIME AREA                         ' 01186
DSSBYOVL DC    CL50'BYTES LEFT ON CURRENT INDEPENDENT OVERFLOW TRACK  ' 01187
DSSRORG2 DC    CL50'TRACKS REMAINING IN THE INDEPENDENT OVERFLOW AREA ' 01188
DSSOVRCT DC    CL50'RECORDS IN THE OVERFLOW AREA                      ' 01189
DSSRORG1 DC    CL50'CYLINDER OVERFLOW AREAS THAT ARE FULL             ' 01190
MINRS    DC    CL50'IS THE MINIMUM NUMBER OF RECORDS PER TRACK        ' 01191
AVGRS    DC    CL50'IS THE AVERAGE NUMBER OF RECORDS PER TRACK        ' 01192
MAXRS    DC    CL50'IS THE MAXIMUM NUMBER OF RECORDS PER TRACK        ' 01193
MINBYTES DC    CL50'IS THE MINIMUM NUMBER OF DATA BYTES PER TRACK     ' 01194
AVGBYTES DC    CL50'IS THE AVERAGE NUMBER OF DATA BYTES PER TRACK     ' 01195
MAXBYTES DC    CL50'IS THE MAXIMUM NUMBER OF DATA BYTES PER TRACK     ' 01196
MINGASS  DC    CL50'IS THE MINIMUM NUMBER OF BYTES IN ANY GAS MEMBER  ' 01197
AVGGASS  DC    CL50'IS THE AVERAGE NUMBER OF BYTES IN A GAS MEMBER    ' 01198
MAXGASS  DC    CL50'IS THE MAXIMUM NUMBER OF BYTES IN ANY GAS MEMBER  ' 01199
MINRELS  DC    CL50'IS THE MINIMUM NUMBER OF BYTES IN ANY REAL MEMBER ' 01200
AVGRELS  DC    CL50'IS THE AVERAGE NUMBER OF BYTES IN A REAL MEMBER   ' 01201
MAXRELS  DC    CL50'IS THE MAXIMUM NUMBER OF BYTES IN ANY REAL MEMBER ' 01202
NOREALS  DC    CL50'NO REAL MEMBERS ARE IN THIS PARTITIONED DATA SET  ' 01203
MINBLKS  DC    CL50'IS THE SHORTEST BLOCK LENGTH                      ' 01204
AVGBLKS  DC    CL50'IS THE AVERAGE BLOCK LENGTH                       ' 01205
MAXBLKS  DC    CL50'IS THE MAXIMUM BLOCK LENGTH                       ' 01206
TOTBYTS  DC    CL50'TOTAL DATA BYTES ARE IN THIS DATA SET             ' 01207
NUMBLKS  DC    CL50'TOTAL DATA BLOCKS ARE RECORDED                    ' 01208
GASBLKS  DC    CL50'OF THESE ARE GAS BLOCKS                           ' 01209
EOFSS    DC    CL50'END OF FILE                                       ' 01210
ENDMBR   DC    CL50'END OF MEMBER (FILE MARKS) ARE RECORDED           ' 01211
GASMBR   DC    CL50'OF THESE ARE FOR GAS MEMBERS                      ' 01212
ALLBLK   DC    CL50'DIRECTORY BLOCKS ARE ALLOCATED                    ' 01213
USEBLK   DC    CL50'OF THESE ARE IN USE                               ' 01214
USENAME  DC    CL50'MEMBER NAMES ARE IN THE DIRECTORY                 ' 01215
ALSNAME  DC    CL50'OF THESE ARE ALIASES                              ' 01216
NUMTRKS  DC    CL50'TRACKS ARE ALLOCATED FOR THIS DATA SET            ' 01217
EXTENTS  DC    CL50'IS THE SECONDARY ALLOCATION QUANTITY              ' 01218
NOSEC    DC    CL50'NO SECONDARY ALLOCATION QUANTITY IS IN THE LABEL  ' 01219
FRETRKS  DC    CL50'OF THESE ARE NOT IN USE                           ' 01220
NUMEXTS  DC    CL50'EXTENTS ARE IN THIS DATA SET                      ' 01221
ALNOREAL DC    CL50'12345678 IS AN ALIAS BUT HAS NO "REAL" ENTRY      ' 01222
SCALOS   DC    CL50'DATA SET IS ALLOCATED IN 123456                   ' 01223
NOBDBS   DC    CL50'BYTES ARE USED IN LAST PDS DIRECTORY BLOCK        ' 01224
TRBALS   DC    CL50'BYTES ARE AVAILABLE ON THE LAST USED TRACK        ' 01225
IOERROR  DC    CL50'READ ERROR--ECB=12; CCHHR=12.45.78.01.34          ' 01226
TOOMANY  DC    CL50'TOO MANY CONSECUTIVE I/O ERRORS (10)              ' 01227
MANYENT  DC    CL50'MORE THAN 4000 ENTRIES IN THE MEMBER TABLE        ' 01228
NOTOPEN  DC    CL50'RDJFCB, OBTAIN OR OPEN FOR DDNAME "IN" FAILED     ' 01229
FIRSTRD  DC    CL50'FIRST READ OF AN EXTENT WAS NOT SUCCESSFUL        ' 01230
TTRTOLOW DC    CL50'TTR IN MEMBER TABLE IS LESS THAN THE CURRENT TTR  ' 01231
NOTFOUND DC    CL50'SOME MEMBERS IN THE MEMBER TABLE WERE NOT FOUND   ' 01232
BADERROR DC    CL50'UNDEFINED READ ERROR                              ' 01233
PERMERR  DC    CL50'UNDEFINED PERMANENT ERROR                         ' 01234
EOFSIMS  DC    CL50'BAD DIRECTORY RECORD -- RECORD LENGTH IS NOT 256  ' 01235
BLOCKLEN DC    CL50'IS THE BLOCK LENGTH  (END OF DIRECTORY SIMULATED) ' 01236
DIRERRS  DC    CL50'READ ERROR IN THE DIRECTORY                       ' 01237
BLKNUMS  DC    CL50'IS THE BLOCK NUMBER  (BLOCK IGNORED)              ' 01238
GASERRS  DC    CL50'ERROR IN A GAS MEMBER  (END OF MEMBER SIMULATED)  ' 01239
CURRMBR  DC    CL50'12345678 IS THE MEMBER  (END OF MEMBER SIMULATED) ' 01240
LASTMEMS DC    CL50'12345678 IS THE LAST REAL MEMBER IN THE DATA SET  ' 01241
PROTECT  DC    CL50'X IS THE PROTECTION KEY                           ' 01242
KEYLEN   DC    CL50'IS THE KEY LENGTH                                 ' 01243
KEYPOS   DC    CL50'IS THE RELATIVE KEY POSITION                      ' 01244
NULL     DC    CL50'DATA SET IS EMPTY                                 ' 01245
GASMEM   DC    CL50'"GAS" MEMBER AT TTR TT.TT.RR, DATA:               ' 01246
EXTHDR   DC    CL50'EXTENT  UCB  CC.CC.HH.HH   CC.CC.HH.HH   TRACKS   ' 01247
EXTUND   DC    CL50'------  ---  -----------   -----------   ------   ' 01248
LSTAR    DC    CL50'DS1LSTAR IS MM.BB.BB.CC.CC.HH.HH.RR               ' 01249
GASTRK   DC    CL60'1234567.9 TRACKS WOULD BE REGAINED BY COMPRESSING ' 01250
BLANKS   DC    CL80'                                                  ' 01251
HEXTBL   DC    CL16'0123456789ABCDEF'                                   01252
*                                                                       01253
WORK     DC    CL80' '                                                  01254
DOUBLE   DS    D                                                        01255
LASTMBB  DS    D                                                        01256
JFCBXIT  DC    X'87',AL3(JFCB)            JFCB BLOCK                    01257
JFCB     DS    0D                                                       01258
         IEFJFCBN                         JFCB MAPPING MACRO            01259
*                                                                       01260
OUT      DCB DDNAME=OUT,DSORG=PS,MACRF=PM,RECFM=FB,LRECL=80,BLKSIZE=80  01261
IN       DCB DDNAME=IN,DSORG=PS,MACRF=E,EXLST=JFCBXIT                   01262
*                                                                       01263
MYLABEL  CAMLST SEARCH,JFCBDSNM,JFCBVOLS,WORKAREA                       01264
WORKAREA DS    0D,148C                                                  01265
DS1NOBDB EQU   WORKAREA+16    BYTES USED IN LAST DIRECTORY BLOCK        01266
DS1DSORG EQU   WORKAREA+38    DSORG                                     01267
DS1RECFM EQU   WORKAREA+40    RECFM                                     01268
DS1BLKSI EQU   WORKAREA+42    BLKSIZE                                   01269
DS1LRECL EQU   WORKAREA+44    LRECL                                     01270
DS1KEYL  EQU   WORKAREA+46    KEYLEN                                    01271
DS1RKP   EQU   WORKAREA+47    RELATIVE KEY POSITION                     01272
DS1SCALO EQU   WORKAREA+50    ALLOCATION TYPE                           01273
DS1SAQU  EQU   WORKAREA+51    SECONDARY ALLOCATION QUANTITY             01274
DS1LSTAR EQU   WORKAREA+54    LAST USED TTR                             01275
DS1TRBAL EQU   WORKAREA+57    BYTES REMAINING IN LAST USED TRACK        01276
DS1PTRDS EQU   WORKAREA+91    CCHHR POINTER TO FORMAT 2 DSCB IF ISAM    01277
*                                                                       01278
         LTORG                                                          01279
         DS    0D                                                       01280
BUFFER   DS    32772X                                                   01281
DS2NOLEV EQU   BUFFER+1  (1)      INDEX LEVELS                          01282
DS2DVIND EQU   BUFFER+2  (1)      TRACKS FOR MASTER LEVEL               01283
DS2CYLOV EQU   BUFFER+8  (1)      TRACKS OF CYLINDER OVERFLOW/CYLINDER  01284
DS2TAGDT EQU   BUFFER+15 (2)      RECORDS TAGGED FOR DELETION           01285
DS2RORG3 EQU   BUFFER+17 (3)      OVERFLOW ACCESSES                     01286
DS2NOBYT EQU   BUFFER+20 (2)      BYTES TO HOLD THE HIGHEST INDEX       01287
DS2NOTRK EQU   BUFFER+22 (1)      TRACKS OCCUPPIED BY THE HIGHEST INDEX 01288
DS2PRCTR EQU   BUFFER+23 (4)      RECORDS IN THE PRIME AREA             01289
DS2BYOVL EQU   BUFFER+80 (2)      BYTES LEFT ON THE CURR. IND. OVR. TRK 01290
DS2RORG2 EQU   BUFFER+82 (2)      TRACKS LEFT IN THE IND. OVERFLOW AREA 01291
DS2OVRCT EQU   BUFFER+84 (2)      RECORDS IN THE OVERFLOW AREA          01292
DS2RORG1 EQU   BUFFER+86 (2)      CYLINDER AREAS THAT ARE FULL          01293
*                                                                       01294
SAVETBL  DC    64CL250' ',CL16' '   ROOM FOR 1000 ENTRIES               01295
         DC    64CL250' ',CL16' '   ROOM FOR 1000 ENTRIES               01296
         DC    64CL250' ',CL16' '   ROOM FOR 1000 ENTRIES               01297
         DC    64CL250' ',CL16' '   ROOM FOR 1000 ENTRIES               01298
         DCBD  DSORG=PS,DEVD=DA                                         01299
         END   STATS                                                    01300
/*
//L.SYSLMOD  DD  DISP=SHR,DSN=$SYSP17.DHC.LOAD
//L.SYSIN    DD *
 NAME STATDS(R)
/*
